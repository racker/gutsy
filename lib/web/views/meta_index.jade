extends layout

block append scripts
  script(src='/static/js/arcify.js')
    
block append css
  link(href="/static/css/meta_index.less", rel='stylesheet/less', type='text/css')
  style(type="text/css")
    body {background-image:url('/static/images/gutsy-2.gif'); background-repeat:no-repeat; background-attachment:scroll; background-position: 95% 100%;}

block content
  #chart

  #hidden
    -var project_node_map = {};
    -var idx = 0;
    each project in projects
      if project.devops
        //- hide node info in dom
        -project_node_map[project.url] = idx;
        -idx++;
        -var formatted_project_name = project.name.replace(/\ /g,'\-');
        -var bg_color = null;
        -var ruok = project.get_data("ruok")
        if ruok
          -bg_color = (ruok.status == "ok") ? "#F8A7A7" : "#ECFFEC";
        .node(style="background-color: #{bg_color}")
          .name #{project.name}
          .color #{bg_color}

    each project in projects
      if project.devops
        //- hide edge info in dom
        each dep in project.devops.dependent_services
          .edge #{project.url}
            .source #{project_node_map[project.url]}
            .target #{project_node_map[dep]}


  a(href="https://github.com/racker/gutsy")
    img(style="position: absolute; top: 42px; right: 0; border: 0;", src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png", alt="Fork me on GitHub")
  .container-fluid
    .row-fluid
      div.span2
        .well
          div
            // Buttons
            button(href="#new-project-modal", data-toggle="modal").btn
              i.icon-plus
              | Add Project

          // Add project modal
          div(class="modal hide", id="new-project-modal")
            div.modal-header
              button(type="button", class="close", data-dismiss="modal") X
              h2 Add project
            div.modal-body
              form(id="new-project-form", method="POST")
                label(for="project")
                  h4 Project Name
                input(type="text", name="name")
                label(for="url")
                  h4 Devops.json URL
                input(type="text", name="url")
                hr
                input(id="new-project-submit", class="btn btn-primary", type="submit", value="Save")
          div.filters
            h4 Tag Filters
            ul.unstyled
      // Projects
      div.span10
        each project in projects
          include includes/project